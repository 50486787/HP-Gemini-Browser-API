
---

# ü§ñ Gemini Web Automation API System - User Manual

## üìñ Introduction

This system uses Python and Playwright to "take over" a local Chrome browser, wrapping the Google Gemini web interface into a callable HTTP API. It supports text conversation, image generation (with automatic downloading), and file analysis.

---

## üõ†Ô∏è Step 1: Environment Setup (First Run)

Ensure you have Python 3.8+ installed. Open your terminal (CMD or PowerShell) in the project folder and run the following commands:

```bash
# 1. Install required Python libraries
pip install playwright fastapi uvicorn requests pillow

# 2. Install Playwright browser binaries
playwright install chromium

```

---

## ‚öôÔ∏è Step 2: Chrome Configuration (CRITICAL)

**You must follow these steps strictly. Since we connect to an existing browser, the script cannot automatically set the download path for you.**

### 1. Create a Debug Shortcut

1. Locate your Chrome shortcut, copy it, and rename it to **"Chrome-Debug"**.
2. Right-click the shortcut -> **Properties**.
3. In the **"Target"** field, add a space at the very end and append the following flags:
```text
 --remote-debugging-port=9222 --user-data-dir="C:\sel_chrome_profile"

```


*(Note: `C:\sel_chrome_profile` is a separate profile folder to keep your main browsing data safe.)*

### 2. Manually Set the Default Download Directory

The script expects images to appear in the `downloaded_images` folder inside your project directory.

1. **Create the folder**: Manually create a folder named `downloaded_images` inside your project directory (or run the script once to let it create it).
2. **Open Chrome**: Double-click your **"Chrome-Debug"** shortcut.
3. **Go to Settings**: Type `chrome://settings/downloads` in the address bar.
4. **Change Location**: Click "Change" and select the **`downloaded_images`** folder inside your project directory.
* *Example: If your code is in `D:\GeminiBot`, point it to `D:\GeminiBot\downloaded_images`.*


5. **Disable Prompt**: Ensure the option **"Ask where to save each file before downloading"** is turned **OFF**.
* *Why? If this is On, Chrome will wait for a user click, causing the script to time out.*



---

## üöÄ Step 3: Startup Procedure

Perform these steps in order every time you want to use the system:

### 1. Open Browser & Login

1. Double-click the **"Chrome-Debug"** shortcut.
2. Go to [https://gemini.google.com/](https://gemini.google.com/).
3. Log in to your Google account. Ensure the chat input box is visible.
4. **Do not close this window.** Minimize it if needed, but keep it open.

### 2. Start the API Server

Double-click `start_server.bat` or run the following in your terminal:

```bash
python server.py

```

When you see `Uvicorn running on http://127.0.0.1:8000`, the system is ready.

---

## üì° Step 4: API Usage

### Endpoint Details

* **URL**: `http://127.0.0.1:8000/chat`
* **Method**: `POST`
* **Content-Type**: `application/json`

### JSON Request Examples

**1. Text Chat / Image Generation**

```json
{
  "user_input": "Draw a cyberpunk style cat",
  "new_chat": true
}

```

**2. Image Analysis (Upload)**

```json
{
  "user_input": "Describe this image",
  "file_path": "D:\\images\\my_photo.jpg",
  "new_chat": true
}

```

### Testing with Script

You can use the provided `test_api.py` to verify functionality:

1. Open `test_api.py`.
2. Edit `target_file` to point to a real file on your computer (or set to `None`).
3. Run:
```bash
python test_api.py

```



---

## üìÇ Directory Structure

The system manages the following folders automatically:

| Folder Name | Description | Important Note |
| --- | --- | --- |
| **downloaded_images/** | **Stores images generated by Gemini.** | **Chrome's default download path MUST be set here.** |
| **json_output_cache/** | Stores the full JSON response of every interaction. | Useful for history and debugging. |
| **temp_upload_cache/** | Stores temporary copies of uploaded files. | Fixes file locking/naming issues. Auto-cleaned. |

---

## ‚ùì Troubleshooting (FAQ)

**Q: The script says "Success" but the image list is empty?**

* **A1:** Check your Chrome settings. Did you set the download location to `downloaded_images`?
* **A2:** Check if **"Ask where to save"** is disabled in Chrome settings. If a save dialog pops up, the script fails.
* **A3:** Internet lag. The script waits up to 60 seconds. If the download takes longer, it might timeout.

**Q: `Connection refused` error when starting `server.py`?**

* **A:** Chrome is not running with the debug port. Make sure you opened Chrome using the modified **"Chrome-Debug"** shortcut, not the standard one.

**Q: Can I send multiple requests at the same time?**

* **A:** **No.** Since the script controls a single mouse/keyboard pointer, requests must be processed one by one. FastAPI will queue them automatically.

**Q: How do I stop the server?**

* **A:** Press `Ctrl+C` in the terminal window where `server.py` is running.